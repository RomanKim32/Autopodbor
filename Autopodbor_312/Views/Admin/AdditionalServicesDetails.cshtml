@model List<Services>

@{
    ViewData["Title"] = "Дополнительные услуги";
}

<h1>Дополнительные услуги</h1>

@if(User.IsInRole("admin")) {
    <div>
         <p>
        <a asp-action="CreateServices">Добавить дополнительную услугу</a>
    </p>
    </div>
}
@if (@Model.Count() == 0)
{
	<p>Дополнительные услуги еще не добавлены</p>
}
else
{
	<table class="table">
		<tbody>
			@{
				bool isUser = !User.IsInRole("admin") && !User.IsInRole("mediaManager") && !User.IsInRole("portfolioManager");
			 } 
				@foreach (var item in Model)
				{
					<tr>
						<td id="ServiceName-@item.Name">
							@Html.DisplayFor(modelItem => item.Name)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.Description)
						</td>
                        <td>
                        <img src="@item.Photo" class="card-img-top" alt="Img">
                        </td>
						<td>
						@if (User.IsInRole("admin"))
						{
							<a class="btn btn-info" asp-controller="Admin" asp-action="EditServices" asp-route-id="@item.Id">Изменить</a> 
							<a class="btn btn-info" asp-controller="Admin" asp-action="DeleteServices" asp-route-id="@item.Id">Удалить</a>
						}
						else if (isUser)
						{ 
                            <a onclick="ToOpenModal('@item.Name')"  class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#AdditionalModal"> Заказать </a>
						}
					    </td>
					</tr>
				}
			
		</tbody>
	</table>
}
<div>
    <a asp-action="IndexServices">Назад</a>
</div>

<div class="modal fade" id="AdditionalModal" tabindex="-1" aria-labelledby="AdditionalModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="AdditionalModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form asp-controller="Order" asp-action="CreateOrder">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label class = "control-label">Имя</label>
                <input id="UserNameAdditional" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Номер телефона</label>
                <input id="PhoneAdditional" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Электронная почта</label>
                <input id="emailAdditional" class="form-control" />		
            </div>
            <div class="form-group">
                <label class="control-label">Дополнительная информация</label>
                <input id="commentAdditional" class="form-control" />		
            </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="CreateOrderAdditionalService()">Save changes</button>
      </div>
    </div>
  </div>
</div>

<script>  
    function ToOpenModal(name)
    {
        $('#AdditionalModalLabel').text(name);
    }

    function CreateOrderAdditionalService()
    {
        let name = $('#UserNameAdditional').val();
        let number = $('#PhoneAdditional').val();
        let email = $('#emailAdditional').val();
        let serviceName = $('#AdditionalModalLabel').text();
        let comment = $('#commentAdditional').val();
        $.ajax({
            url: '@Url.Action("CreateCallBackAndAdditionalService", "Order")',
            type: 'POST',
            data: {
                'userName' : name,
                'phoneNumber' : number,
                'email' : email,
                'comment' : comment,
                'serviceName' : serviceName
            },
            success: window.location.href = '/Admin/AdditionalServicesDetails',
        });
            event.preventDefault();
    }
</script>